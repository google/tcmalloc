name: Bazel build

on:
    push: {}
    pull_request: {}

jobs:
    build:
        name: Build tcmalloc
        runs-on: ubuntu-latest
        steps:

        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Mount bazel cache
          uses: actions/cache@v2
          with:
            path: "~/.cache/bazel"
            key: bazel

        - name: Install bazelisk
          run: |
            curl -LO "https://github.com/bazelbuild/bazelisk/releases/download/v1.1.0/bazelisk-linux-amd64"
            mkdir -p "${GITHUB_WORKSPACE}/bin/"
            mv bazelisk-linux-amd64 "${GITHUB_WORKSPACE}/bin/bazel"
            chmod +x "${GITHUB_WORKSPACE}/bin/bazel"

        - name: Test
          run: |
            "${GITHUB_WORKSPACE}/bin/bazel" test //...

        - name: Build
          run: |
            "${GITHUB_WORKSPACE}/bin/bazel" build //...
